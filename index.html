<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Wisdom App (Cloud)</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        body, .serif, .sans { font-family: 'Inter', sans-serif !important; }
        .A4-page {
            width: 210mm; min-height: 297mm; padding: 20mm; margin: 0 auto;
            background: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); color: #000;
        }
        @media (max-width: 768px) { .A4-page { width: 100%; padding: 20px; min-height: auto; } }
        @keyframes bounce-in { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-bounce-in { animation: bounce-in 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @media print { .break-inside-avoid { page-break-inside: avoid; } }
    </style>
</head>
<body class="bg-[#F3F4F6]">
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 0. CẤU HÌNH SUPABASE (BẠN ĐIỀN VÀO ĐÂY)
        // ==========================================
        
        // Vào Settings -> API -> Project URL
        const SUPABASE_URL = 'https://nfojmndryasqyzyoyomi.supabase.co'; 
        
        // Vào Settings -> API -> Project API keys -> anon public
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mb2ptbmRyeWFzcXl6eW95b21pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNjgxMDgsImV4cCI6MjA3ODg0NDEwOH0.kyMOYBdkOGCsb_PapGgHAYtGYXKMyHLIOrY1aNdBUDI'; 

        // Khởi tạo Client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const { useState, useEffect } = React;

        // ==========================================
        // 1. ICONS
        // ==========================================
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const LogOut = (props) => <IconBase {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></IconBase>;

        // ==========================================
        // 2. MAIN APP
        // ==========================================

        function MatrixWisdomApp() {
            const [users, setUsers] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            const [view, setView] = useState('login'); 
            const [reportData, setReportData] = useState(null);
            const [formData, setFormData] = useState({ 
        name: '', birthDay: '', birthMonth: '', birthYear: '', 
        targetMonth: String(new Date().getMonth()+1).padStart(2,'0'), 
        targetYear: String(new Date().getFullYear()) 
    });
            const [loading, setLoading] = useState(false);
            const [toast, setToast] = useState(null);

            // Fetch users (cho Admin)
            const fetchUsers = async () => {
                const { data, error } = await supabase.from('users').select('*').order('id', { ascending: true });
                if (data) setUsers(data);
            };

            // Load users khi vào admin
            useEffect(() => {
                if (view === 'admin') fetchUsers();
            }, [view]);

            // Login
            const handleLogin = async (u, p) => {
                setLoading(true);
                const { data, error } = await supabase.from('users').select('*').eq('username', u).eq('password', p).single();
                setLoading(false);
                if (data) {
                    setCurrentUser(data);
                    setView('app');
                } else {
                    showToast('Sai thông tin đăng nhập', 'error');
                }
            };

            // Register
            const handleRegister = async (u, p) => {
                if(!u || !p) return showToast('Nhập đủ thông tin', 'error');
                setLoading(true);
                
                // Check exist
                const { data: exist } = await supabase.from('users').select('id').eq('username', u).single();
                if (exist) {
                    setLoading(false);
                    return showToast('Tài khoản đã tồn tại', 'error');
                }

                const { data, error } = await supabase
                    .from('users')
                    .insert([{ username: u, password: p, role: 'user', allowed_frames: [] }])
                    .select().single();
                
                setLoading(false);
                if (!error) {
                    showToast('Đăng ký thành công');
                    setCurrentUser(data);
                    setView('app');
                } else {
                    showToast('Lỗi: ' + error.message, 'error');
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setReportData(null);
                setView('login');
            };

            const showToast = (msg, type = 'success') => {
                setToast({ msg, type });
                setTimeout(() => setToast(null), 3000);
            };

            return (
                <div className="min-h-screen text-[#111827] font-sans">
                    {toast && (
                        <div className="fixed top-4 right-4 z-50 bg-white shadow-lg px-4 py-3 rounded-lg border border-gray-100 flex items-center gap-3 animate-bounce-in">
                            {toast.type === 'error' ? <AlertCircle size={18} className="text-red-500"/> : <Check size={18} className="text-green-500"/>}
                            <span className="text-sm font-medium">{toast.msg}</span>
                        </div>
                    )}

                    {view === 'login' ? (
                        <LoginScreen onLogin={handleLogin} onRegister={handleRegister} loading={loading} />
                    ) : (
                        <div className="flex flex-col min-h-screen">
                            <NavBar 
                                user={currentUser} 
                                onLogout={handleLogout} 
                                currentView={view} setView={setView}
                                isReport={!!reportData} 
                                onExport={() => exportPDF(reportData?.name)}
                            />
                            <main className="flex-1 w-full p-4 md:p-8 overflow-y-auto">
                                {view === 'admin' ? (
                                    <AdminPanel users={users} fetchUsers={fetchUsers} showToast={showToast} />
                                ) : (
                                    <React.Fragment>
                                        {!reportData ? (
                                            <InputSection 
                                                user={currentUser} 
                                                form={formData} 
                                                    setForm={setFormData}
                                                onCalculate={(data) => {
                                                    setLoading(true);
                                                    setTimeout(() => { setReportData(data); setLoading(false); }, 800);
                                                }}
                                                showToast={showToast} loading={loading}
                                            />
                                        ) : (
                                            <ReportView data={reportData} onReset={() => setReportData(null)} />
                                        )}
                                    </React.Fragment>
                                )}
                            </main>
                        </div>
                    )}
                </div>
            );
        }

        // ==========================================
        // 3. COMPONENTS
        // ==========================================

        const LoginScreen = ({ onLogin, onRegister, loading }) => {
            const [isRegister, setIsRegister] = useState(false);
            const [u, setU] = useState('');
            const [p, setP] = useState('');
            const [confirmP, setConfirmP] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (isRegister && p !== confirmP) return alert("Mật khẩu không khớp");
                isRegister ? onRegister(u, p) : onLogin(u, p);
            };

            return (
                <div className="h-screen flex items-center justify-center bg-[#F3F4F6]">
                    <div className="bg-white p-10 rounded-xl shadow-sm border border-gray-200 w-full max-w-sm">
                        <h1 className="text-2xl font-bold text-center mb-8">{isRegister ? 'Đăng Ký' : 'Đăng Nhập'}</h1>
                        <form onSubmit={handleSubmit} className="space-y-5">
                            <div>
                                <label className="block text-xs font-semibold uppercase text-gray-500 mb-1.5">Tài khoản</label>
                                <input className="w-full p-3 border border-gray-200 rounded-lg focus:border-gray-900 outline-none text-sm" value={u} onChange={e=>setU(e.target.value)} required autoFocus placeholder="Username"/>
                            </div>
                            <div>
                                <label className="block text-xs font-semibold uppercase text-gray-500 mb-1.5">Mật khẩu</label>
                                <input type="password" className="w-full p-3 border border-gray-200 rounded-lg focus:border-gray-900 outline-none text-sm" value={p} onChange={e=>setP(e.target.value)} required placeholder="Password"/>
                            </div>
                            {isRegister && (
                                <div className="animate-bounce-in">
                                    <label className="block text-xs font-semibold uppercase text-gray-500 mb-1.5">Xác nhận MK</label>
                                    <input type="password" className="w-full p-3 border border-gray-200 rounded-lg focus:border-gray-900 outline-none text-sm" value={confirmP} onChange={e=>setConfirmP(e.target.value)} required placeholder="Nhập lại password"/>
                                </div>
                            )}
                            <button disabled={loading} className="w-full bg-gray-900 hover:bg-black text-white py-3 rounded-lg font-semibold mt-2 transition-colors disabled:opacity-50 text-sm">
                                {loading ? 'Đang xử lý...' : (isRegister ? 'Đăng Ký' : 'Đăng Nhập')}
                            </button>
                        </form>
                        <div className="mt-6 text-center text-sm text-gray-500">
                            {isRegister ? 'Đã có tài khoản? ' : 'Chưa có tài khoản? '}
                            <button onClick={()=>setIsRegister(!isRegister)} className="font-bold text-gray-900 hover:underline">{isRegister ? 'Đăng nhập' : 'Đăng ký'}</button>
                        </div>
                    </div>
                </div>
            );
        };

        const NavBar = ({ user, onLogout, currentView, setView, isReport, onExport }) => (
            <nav className="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-0 z-30">
                <div className="font-bold text-xl cursor-pointer flex items-center gap-2" onClick={() => setView('app')}>
                    <div className="w-8 h-8 bg-gray-900 rounded-lg flex items-center justify-center text-white text-xs font-bold">M</div>
                    Matrix Wisdom
                </div>
                <div className="flex items-center gap-5 text-sm font-medium">
                  
                    {user?.role === 'admin' && (
                        <button onClick={() => setView(currentView === 'admin' ? 'app' : 'admin')} className={`flex items-center gap-1.5 ${currentView === 'admin' ? 'text-gray-900 font-bold' : 'text-gray-500 hover:text-gray-900'}`}>
                            <Settings size={18} /> Quản trị
                        </button>
                    )}
                    <div className="h-5 w-px bg-gray-200"></div>
                    <div className="flex items-center gap-3">
                        <span className="text-gray-600 hidden sm:inline">{user?.username}</span>
                        <button onClick={onLogout} className="text-gray-400 hover:text-red-600"><LogOut size={18}/></button>
                    </div>
                </div>
            </nav>
        );

        const AdminPanel = ({ users, fetchUsers, showToast }) => {
            const [newUser, setNewUser] = useState({ username: '', password: '' });
            const [perm, setPerm] = useState({ month: '01', year: new Date().getFullYear() });
            const [activeUser, setActiveUser] = useState(null);

            const addUser = async (e) => {
                e.preventDefault();
                if(!newUser.username || !newUser.password) return;
                const { error } = await supabase.from('users').insert([{ ...newUser, role: 'user', allowed_frames: [] }]);
                if (!error) {
                    setNewUser({ username: '', password: '' });
                    showToast('Đã thêm thành viên');
                    fetchUsers();
                } else showToast('Lỗi: ' + error.message, 'error');
            };

            const addPerm = async () => {
                if(!activeUser) return;
                const current = activeUser.allowed_frames || [];
                if(current.some(p => p.month === perm.month && p.year == perm.year)) return showToast('Đã có quyền này', 'error');
                
                const newFrames = [...current, { month: perm.month, year: String(perm.year) }];
                const { error } = await supabase.from('users').update({ allowed_frames: newFrames }).eq('id', activeUser.id);
                if (!error) {
                    setActiveUser({ ...activeUser, allowed_frames: newFrames });
                    fetchUsers();
                    showToast('Đã thêm quyền');
                }
            };

            const removePerm = async (idx) => {
                if(!activeUser) return;
                const newFrames = activeUser.allowed_frames.filter((_, i) => i !== idx);
                const { error } = await supabase.from('users').update({ allowed_frames: newFrames }).eq('id', activeUser.id);
                if (!error) {
                    setActiveUser({ ...activeUser, allowed_frames: newFrames });
                    fetchUsers();
                }
            };

            const deleteUser = async (id) => {
                if(!confirm("Xóa user này?")) return;
                const { error } = await supabase.from('users').delete().eq('id', id);
                if (!error) {
                    fetchUsers();
                    if(activeUser?.id === id) setActiveUser(null);
                }
            };

            return (
                <div className="max-w-5xl mx-auto">
                    <div className="mb-8"><h2 className="text-2xl font-bold">Quản Trị (Cloud)</h2></div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div className="md:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <h3 className="font-bold mb-4 pb-2 border-b border-gray-100 flex justify-between">Danh sách <span className="text-gray-500 font-normal">{users.length}</span></h3>
                            <div className="space-y-2 mb-6 max-h-[400px] overflow-y-auto pr-2">
                                {users.map(u => (
                                    <div key={u.id} className={`p-3 flex justify-between items-center rounded-lg cursor-pointer border ${activeUser?.id === u.id ? 'bg-gray-50 border-gray-300' : 'border-transparent hover:bg-gray-50'}`} onClick={() => u.role !== 'admin' && setActiveUser(u)}>
                                        <div className="flex items-center gap-3">
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${activeUser?.id === u.id ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-500'}`}>{u.username[0].toUpperCase()}</div>
                                            <div><div className="font-semibold text-sm">{u.username}</div><div className="text-xs text-gray-500">{u.role}</div></div>
                                        </div>
                                        {u.role !== 'admin' && <button onClick={(e) => { e.stopPropagation(); deleteUser(u.id); }} className="text-gray-300 hover:text-red-500 p-2"><Trash2 size={16}/></button>}
                                    </div>
                                ))}
                            </div>
                            <form onSubmit={addUser} className="flex flex-col md:flex-row gap-3 bg-gray-50 p-3 rounded-lg border border-gray-200">
                                <input placeholder="Username" className="flex-1 p-2 bg-white border border-gray-200 rounded text-sm outline-none" value={newUser.username} onChange={e=>setNewUser({...newUser, username:e.target.value})}/>
                                <input placeholder="Password" className="flex-1 p-2 bg-white border border-gray-200 rounded text-sm outline-none" value={newUser.password} onChange={e=>setNewUser({...newUser, password:e.target.value})}/>
                                <button className="bg-gray-900 text-white px-4 py-2 rounded text-sm font-bold">Thêm</button>
                            </form>
                        </div>
                        <div className="md:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-gray-200 h-fit">
                            <h3 className="font-bold mb-4 pb-2 border-b border-gray-100">Cấp quyền: <span className="text-blue-600">{activeUser?.username || '...'}</span></h3>
                            {activeUser ? (
                                <>
                                    <div className="flex gap-2 mb-4">
                                        <select className="p-2 border border-gray-200 rounded text-sm flex-1 outline-none" value={perm.month} onChange={e=>setPerm({...perm, month:e.target.value})}>
                                            {Array.from({length: 12},(_,i)=>i+1).map(m=><option key={m} value={m<10?`0${m}`:`${m}`}>Tháng {m}</option>)}
                                        </select>
                                        <input type="number" className="p-2 border border-gray-200 rounded text-sm w-20 text-center outline-none" value={perm.year} onChange={e=>setPerm({...perm, year:e.target.value})}/>
                                        <button onClick={addPerm} className="bg-gray-900 text-white px-3 rounded"><Plus size={16}/></button>
                                    </div>
                                    <div className="space-y-2 max-h-[300px] overflow-auto">
                                        {(activeUser.allowed_frames||[]).map((p,i)=>(
                                            <div key={i} className="flex justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 text-sm group">
                                                <span>Tháng {p.month}/{p.year}</span>
                                                <button onClick={()=>removePerm(i)} className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><X size={16}/></button>
                                            </div>
                                        ))}
                                        {(!activeUser.allowed_frames?.length) && <div className="text-center text-xs text-gray-400 py-4">Chưa có quyền</div>}
                                    </div>
                                </>
                            ) : <div className="text-center text-sm text-gray-400 py-10">Chọn tài khoản để xem</div>}
                        </div>
                    </div>
                </div>
            );
        };

      const InputSection = ({ user, onCalculate, showToast, loading, form, setForm }) => {
             const days = Array.from({length: 31},(_,i)=>i+1);
            const months = Array.from({length: 12},(_,i)=>i+1);

            const submitManual = () => {
                const { name, birthDay, birthMonth, birthYear, targetMonth, targetYear } = form;
                if (!name || !birthDay || !birthMonth || !birthYear) return showToast('Nhập đủ thông tin', 'error');
                if (user.role !== 'admin') {
                    const frames = user.allowed_frames || [];
                    if (!frames.some(p => p.month === targetMonth && p.year === targetYear)) return showToast(`Chưa có quyền xem Tháng ${targetMonth}/${targetYear}`, 'error');
                }
                onCalculate(calculateMatrixLogic(name, parseInt(birthDay), targetMonth, targetYear));
            };

            const submitPreset = (m, y) => {
                const { name, birthDay, birthMonth, birthYear } = form;
                if (!name || !birthDay || !birthMonth || !birthYear) return showToast('Nhập đủ Tên và Ngày sinh trước', 'error');
                onCalculate(calculateMatrixLogic(name, parseInt(birthDay), m, y));
            };

            return (
                <div className="flex flex-col items-center justify-center py-12">
                    <div className="bg-white p-8 md:p-10 rounded-xl shadow-sm border border-gray-200 w-full max-w-lg">
                        <div className="text-center mb-8"><h2 className="text-2xl font-bold">Tra Cứu Thông Tin</h2></div>
                        <div className="space-y-5">
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1.5 uppercase">Họ và Tên</label>
                                <input className="w-full p-3 border border-gray-200 rounded-lg focus:border-gray-900 outline-none uppercase font-semibold" placeholder="NGUYỄN VĂN A" value={form.name} onChange={e=>setForm({...form, name:e.target.value.toUpperCase()})}/>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1.5 uppercase">Ngày, Tháng, Năm Sinh mà bạn hay dùng nhất</label>
                                <div className="flex gap-3">
                                    <select className="flex-1 p-3 border border-gray-200 rounded-lg outline-none bg-white" value={form.birthDay} onChange={e=>setForm({...form, birthDay:e.target.value})}>
                                        <option value="" disabled>Ngày</option>{days.map(d=><option key={d} value={d}>{d}</option>)}
                                    </select>
                                    <select className="flex-1 p-3 border border-gray-200 rounded-lg outline-none bg-white" value={form.birthMonth} onChange={e=>setForm({...form, birthMonth:e.target.value})}>
                                        <option value="" disabled>Tháng</option>{months.map(m=><option key={m} value={m<10?`0${m}`:`${m}`}>{m}</option>)}
                                    </select>
                        
                                    <input 
                                            className="w-24 p-3 border border-gray-200 rounded-lg outline-none text-center" // Đã sửa flex-1 thành w-24
                                            placeholder="Năm" 
                                            value={form.birthYear} 
                                            onChange={e=>setForm({...form, birthYear:e.target.value})}
                                        />
                                </div>
                            </div>
                            <hr className="border-gray-100 my-4"/>
                            {user.role === 'admin' ? (
                                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <div className="text-xs font-bold text-gray-500 mb-2 uppercase">Admin: Chọn Tháng Xem</div>
                                    <div className="flex gap-3 mb-3">
                                        <select className="flex-1 p-2 border border-gray-200 rounded bg-white text-sm" value={form.targetMonth} onChange={e=>setForm({...form, targetMonth:e.target.value})}>
                                            {months.map(m=><option key={m} value={m<10?`0${m}`:`${m}`}>Tháng {m}</option>)}
                                        </select>
                                        <input className="w-24 p-2 border border-gray-200 rounded bg-white text-center text-sm" value={form.targetYear} onChange={e=>setForm({...form, targetYear:e.target.value})}/>
                                    </div>
                                    <button onClick={submitManual} disabled={loading} className="w-full bg-gray-900 text-white py-2.5 rounded font-bold hover:bg-black disabled:opacity-50 text-sm">{loading?'Đang tính...':'Xem Báo Cáo'}</button>
                                </div>
                            ) : (
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 mb-3 uppercase text-center">Chọn thời điểm xem báo cáo</label>
                                    {(user.allowed_frames && user.allowed_frames.length > 0) ? (
                                        <div className="grid grid-cols-1 gap-3">
                                            {user.allowed_frames.map((f,i) => (
                                                <button key={i} onClick={()=>submitPreset(f.month, f.year)} disabled={loading} className="flex items-center justify-between w-full p-4 bg-white border border-gray-200 rounded-xl hover:border-gray-900 hover:shadow-md transition-all group">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-gray-900 group-hover:text-white transition-colors"><Calendar size={20}/></div>
                                                        <div className="text-left"><div className="font-bold text-gray-900">Tháng {f.month}/{f.year}</div><div className="text-xs text-gray-500">Bấm để xem</div></div>
                                                    </div>
                                                    <div className="text-gray-400 group-hover:text-gray-900">→</div>
                                                </button>
                                            ))}
                                        </div>
                                    ) : <div className="text-center p-6 border-2 border-dashed border-gray-200 rounded-lg bg-gray-50 text-gray-500 text-sm">Chưa có quyền xem tháng nào.<br/>Liên hệ Admin.</div>}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

  // ==========================================
// Thay thế toàn bộ ReportView cũ bằng đoạn này
// ==========================================
const ReportView = ({ data, onReset }) => {
    // Logic tính ngày
    let endMonth = parseInt(data.month) + 1;
    let endYear = parseInt(data.year);
    if (endMonth > 12) { endMonth = 1; endYear = endYear + 1; }
    const endMonthStr = endMonth < 10 ? `0${endMonth}` : endMonth;

    return (
        <div className="flex flex-col items-center pb-20">
            <div className="w-full max-w-[210mm] mb-6 flex justify-between items-center">
                <button onClick={onReset} className="text-sm font-medium text-gray-500 hover:text-gray-900 flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-white"><X size={16}/> Quay lại</button>
            </div>
            <div id="print-area" className="A4-page text-gray-900">
                <div className="text-center mb-12 pb-8 border-b-2 border-gray-900">
                    <h1 className="text-4xl font-extrabold mb-4 uppercase">Bật Mí Huyền Cơ Từng Tháng Trong Năm</h1>
                    <div className="text-xl font-bold uppercase mb-2">{data.name}</div>
                    <div className="text-sm font-medium text-gray-500 flex justify-center gap-4 uppercase">
                        <span>Ngày sinh: {data.day}</span>
                        <span>•</span>
                        <span>
                            Dự báo: {data.day}/{data.month}/{data.year} — {data.day}/{endMonthStr}/{endYear}
                        </span>
                    </div>
                </div>
                <div className="mb-12 text-center px-10">
                    <div className="inline-block relative">
                        <span className="text-4xl absolute -top-4 -left-6 text-gray-300">“</span>
                        <p className="font-medium italic text-xl leading-relaxed text-gray-700">{data.vibe}</p>
                        <span className="text-4xl absolute -bottom-8 -right-6 text-gray-300">”</span>
                    </div>
                </div>
                <div className="space-y-8">
                    {data.cards.map((c, i) => (
                        <div key={i} className="break-inside-avoid">
                            
                            {/* --- PHẦN SỬA Ở ĐÂY --- */}
                       
                           {/* --- SỬA LẠI ĐOẠN NÀY (Bỏ class 'uppercase') --- */}
<h3 className="text-lg font-bold mb-3 flex items-baseline gap-3">
    {/* 1. Số thứ tự trong hộp đen */}
    <span className="bg-gray-900 text-white w-6 h-6 flex items-center justify-center rounded text-xs flex-shrink-0 translate-y-[-2px]">
        {i+1}
    </span>
    
    {/* 2. Nội dung: Hiển thị nguyên bản (Không...) thay vì IN HOA (KHÔNG...) */}
    <span 
        className="text-3xl text-gray-800 leading-normal" 
        style={{ fontFamily: "'Great Vibes', cursive", fontWeight: '400' }}
    >
        {c.title}
    </span>
</h3>

                            {/* ---------------------- */}

                            <div className="pl-9 text-justify leading-7 text-[15px]" dangerouslySetInnerHTML={{ __html: c.content }}/>
                        </div>
                    ))}
                </div>
                <div className="mt-16 pt-8 border-t border-gray-200 text-center text-xs text-gray-400 font-medium uppercase tracking-widest"><p>Báo cáo từ Matrix Wisdom.</p><p className="mt-1">© {new Date().getFullYear()} Heart Sun. All rights reserved.</p></div>
            </div>
        </div>
    );
};   

// 4. LOGIC ENGINE
        // ==========================================
        function calculateMatrixLogic(name, day, monthStr, yearStr) {
            const raw = `${day}${monthStr}${yearStr}`;
            let n1 = raw.split('').reduce((a,b)=>a+parseInt(b),0);
            let n2 = n1.toString().split('').reduce((a,b)=>a+parseInt(b),0);
            let firstDigit = day < 10 ? day : Math.floor(day/10);
            let n3 = n1 - (2 * firstDigit);
            let n4 = Math.abs(n3).toString().split('').reduce((a,b)=>a+parseInt(b),0);
            let allStr = raw + n1 + n2 + n3 + n4;
            let counts = {};
            for(let char of allStr) counts[char] = (counts[char]||0)+1;

            const vibes = ["Năng lượng là chìa khóa mở cánh cửa định mệnh.", "Tĩnh lặng hôm nay, thành tựu ngày mai.", "Chuyển hóa nghiệp lực thành nguyện lực.", "Kết nối bên trong, tỏa sáng bên ngoài.", "Kỷ luật là tự do đích thực."];
            const cards = [];
            const rep = (n, c) => String(n).repeat(Math.max(0, c));

// --- LOGIC XỬ LÝ SỐ 1 ---
const count1 = counts[1] || 0;
if (count1 > 0) {
    if (count1 >= 3) {
        // Nhiều số 1 (111, 1111...)
        cards.push({
            title: rep(1, count1),
            content: `<b>VIỆC CẦN LÀM:</b><br/>Cần bước ra ngoài gặp gỡ, tìm kiếm trải nghiệm để làm, có thể là đi coi phim, đi cà phê, đi ăn, đi chơi, đi hái rau, tưới cây, chạy bộ, bơi lội, đi dạo, hoặc đi làm công việc gì đó, ít tiền hay nhiều tiền đều được, để tương tác, để thử những môn, những lĩnh vực, những trải nghiệm mới. Đừng ngồi yên trong nhà chỉ để coi tiktok, tivi,… Xung quanh bạn càng nhiều việc càng tốt, càng nhiều trải nghiệm mới càng tốt, sẽ càng cảm thấy dễ chịu, và bạn sẽ bớt suy tư miên man, suy nghĩ lung tung đi rất nhiều.`
        });
    } else {
        // Ít số 1 (1, 11)
        cards.push({
            title: rep(1, count1),
            content: `Sự hỗn loạn từ thế giới bên ngoài sẽ không ảnh hưởng quá lớn đến nội tâm bên trong bạn. Tháng này sẽ khá yên ổn, yêu đời, nhẹ nhàng, không có nhiều thứ làm bạn bận tâm. Hãy học và làm việc bình thường như mọi khi.`
        });
    }
}

// --- LOGIC XỬ LÝ SỐ 6 ---
const count6 = counts[6] || 0;
if (count6 === 1) {
    cards.push({
        title: rep(6, count6),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Đừng quá an toàn, nếu bạn quá an toàn và không chấp nhận sai lầm của bản thân, bạn sẽ bỏ lỡ đi một góc nhìn sâu sắc nào đó, bỏ qua một cơ hội nào đó để trưởng thành. Hãy cho phép bản thân được sai lầm trong tháng này.<br/>Cần nhìn thẳng vào sai lầm của bản thân và phân tích lý do, đúng sai ở đâu, đúc kết những kinh nghiệm từ những sai lầm cũ, nhờ đó mà tốc độ trưởng thành của bạn sẽ rất nhanh.<br/>Sau khi ngộ ra được rồi, bạn sẽ cảm thấy rất khác, cảm thấy rất chín chắn, trưởng thành hơn, tỉnh táo hơn. Những biến cố, những sự mù quáng, ngu ngơ sẽ có giá trị lớn với bạn và với riêng bạn, những người xung quanh sẽ không thấy rõ.`
    });
} else if (count6 >= 2) {
    cards.push({
        title: rep(6, count6),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Đừng quá an toàn, nếu bạn quá an toàn và không chấp nhận sai lầm của bản thân, bạn sẽ bỏ lỡ đi một góc nhìn sâu sắc nào đó, bỏ qua một cơ hội nào đó để trưởng thành. Hãy cho phép bản thân được sai lầm trong tháng này.<br/>Tháng này sẽ có sự tác động khá mạnh mẽ tới nhận thức, tư duy của bạn.<br/>Cần nhìn thẳng vào sai lầm của bản thân và phân tích lý do, đúng sai ở đâu, đúc kết những kinh nghiệm từ những sai lầm cũ, nhờ đó mà tốc độ trưởng thành của bạn sẽ rất nhanh.<br/>Sau khi ngộ ra được rồi, bạn sẽ cảm thấy rất khác, cảm thấy rất chín chắn, trưởng thành hơn, tỉnh táo hơn. Những biến cố, những sự mù quáng, ngu ngơ sẽ có giá trị lớn với bạn và với riêng bạn, những người xung quanh sẽ không thấy rõ.`
    });
}

// --- LOGIC XỬ LÝ SỐ 3 VÀ SỐ 8 ---
const has3 = (counts[3] || 0) > 0;
const has8 = (counts[8] || 0) > 0;

if (has3 && !has8) {
    // CHỈ CÓ SỐ 3
    cards.push({
        title: rep(3, counts[3]),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Bạn cần gia tăng tương tác với xã hội, mở rộng mối quan hệ mới, bước ra vùng an toàn, kết nối hòa nhập với mọi người. Bạn sẽ có nhiều cơ hội gặp được nhiều quý nhân trong cuộc đời bạn. Quý nhân ở đây có thể là khách hàng, đối tác làm ăn, thầy/cô,…`
    });
} else if (has3 && has8) {
    // CÓ CẢ 3 VÀ 8
    cards.push({
        title: `${rep(3, counts[3])} & ${rep(8, counts[8])}`,
        content: `Hãy dành ra 50% thời gian trong ngày để bước ra ngoài giao tiếp, mở rộng mối quan hệ mới và 50% thời gian còn lại để làm những việc mà bạn yêu thích, lúc này bạn chỉ cần lên tiếng thì hầu như tất cả mọi người sẽ hỗ trợ, giúp đỡ bạn ngay.`
    });
} else if (!has3 && !has8) {
    // KHÔNG CÓ 3 VÀ KHÔNG CÓ 8
    cards.push({
        title: "Không 3 & Không 8",
        content: `Đừng chiều chuộng cảm xúc của bản thân, đừng tập trung tận hưởng. Những thứ mình muốn sẽ không dễ dàng được đáp ứng. Cũng không có quá nhiều quý nhân xuất hiện trong tháng này, để chỉ điểm, hỗ trợ hoặc mang tới nguồn tài chính cho mình. Hãy độc lập, tự đứng lên và làm việc nghiêm túc, bền bỉ, tập trung.`
    });
} else if (has8 && !has3) {
    // CHỈ CÓ SỐ 8
    cards.push({
        title: rep(8, counts[8]),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy dành thời gian để thư giãn, tận hưởng cuộc sống nhiều hơn một chút. Tận hưởng những thứ mà bạn đã tạo ra, chăm sóc, yêu thương bản thân. Nếu bạn chưa có tiền mà có rất nhiều thời gian trống thì hãy sử dụng thời gian đó hợp lý, như học tập, đọc sách, xem phim,… chẳng hạn. Nếu bạn có tiền thì đây là tháng mà bạn sẽ sử dụng số tiền đó để đầu tư cho những thứ mà mình thích. Bạn sẽ được phép làm theo những gì mà bạn muốn, mọi người sẽ không tạo quá nhiều áp lực cho bạn.`
    });
}

// --- LOGIC XỬ LÝ SỐ 7 ---
const has7 = (counts[7] || 0) > 0;
if (has7) {
    cards.push({
        title: rep(7, counts[7]),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Trong tháng này, bạn sẽ quan tâm nhiều tới mục tiêu, hoài bão và đam mê cá nhân. Bạn sẽ biết được bạn có thể làm được gì, và cần phải làm gì. Thế nên đây là lúc để bạn tự hỏi các câu hỏi như “Tôi có thể làm được gì, đam mê của tôi là gì, khả năng của tôi là gì, mục tiêu thế nào, lý tưởng ra sao?”`
    });
} else {
    cards.push({
        title: "Không 7",
        content: `Hãy bám sát vào đời sống thực tế hiện tại để làm việc, không cần quan tâm quá nhiều tới việc bạn có thể làm được gì, hãy tập trung xử lý các vấn đề còn lại trong tháng này. Đừng tập trung quá nhiều vào các câu hỏi như "Tôi là ai?", "Tôi có thể làm được gì?", "Điểm mạnh thật sự của tôi là gì?”, “Tầm nhìn, lý tưởng của tôi là gì?".`
    });
}

// --- LOGIC XỬ LÝ SỐ 2 (KẾT HỢP VỚI 7) ---
const count2 = counts[2] || 0;
if (count2 > 0) {
    const isMany2 = count2 >= 3; // Nhiều số 2 (222, 2222...)
    const isFew2 = count2 === 1 || count2 === 2; // 1 hoặc 2 số 2

    let title2 = rep(2, count2);
    if (has7) title2 += ` & ${rep(7, counts[7])}`;

    if (isFew2 && !has7) {
        // Có 1 và 2 số 2 & KHÔNG CÓ 7
        cards.push({
            title: title2,
            content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy tập trung phục vụ mọi người, và thực hiện các nghĩa vụ, trách nhiệm với cộng đồng, cũng như với gia đình. Chức vụ càng lớn thì trách nhiệm càng lớn. Càng phục vụ cho người khác thì sự thăng tiến của bạn sẽ càng nhanh.<br/>Những công việc mà bạn cần tập trung đều nằm trước mắt bạn, sát bên tai bạn. Bao gồm cả những việc bạn chia sẻ những kiến thức chuyên môn mà bạn có để giúp đỡ những người đang cần (tu tập, tâm lý, kinh doanh...).<br/><b>LƯU Ý:</b> Bạn làm để phục vụ cộng đồng vì tình yêu, chứ không phải vì mục đích lợi lạc cho bản thân. Đừng để ý quá nhiều tới mục tiêu cá nhân. Hãy tập trung xử lý những việc trước mắt.`
        });
    } else if (isMany2 && !has7) {
        // Có nhiều số 2 & KHÔNG CÓ 7
        cards.push({
            title: title2,
            content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy tập trung phục vụ mọi người, và thực hiện các nghĩa vụ, trách nhiệm với cộng đồng, cũng như với gia đình. Bạn có nhiều nghĩa vụ, trách nhiệm mà bạn cần chủ động nhận ra và tự giác thực hiện. Chức vụ càng lớn thì trách nhiệm càng lớn. Càng phục vụ cho người khác thì sự thăng tiến của bạn sẽ càng nhanh.<br/>Những công việc mà bạn cần tập trung đều nằm trước mắt bạn, sát bên tai bạn. Bao gồm cả việc chia sẻ kiến thức chuyên môn.<br/><b>LƯU Ý:</b> Bạn làm để phục vụ cộng đồng vì tình yêu, chứ không phải vì mục đích lợi lạc cho bản thân. Đừng để ý quá nhiều tới mục tiêu cá nhân. Hãy tập trung xử lý những việc trước mắt.`
        });
    } else if (isFew2 && has7) {
        // Có 1 và 2 số 2 & CÓ 7
        cards.push({
            title: title2,
            content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy tập trung phục vụ mọi người, và thực hiện các nghĩa vụ, trách nhiệm với cộng đồng, cũng như với gia đình. Chức vụ càng lớn thì trách nhiệm càng lớn. Càng phục vụ cho người khác thì sự thăng tiến của bạn sẽ càng nhanh.<br/>Những công việc mà bạn cần tập trung đều nằm trước mắt bạn. Bao gồm cả việc chia sẻ kiến thức chuyên môn.<br/><b>LƯU Ý:</b> Bạn làm để phục vụ cộng đồng vì tình yêu, chứ không phải vì mục đích lợi lạc cho bản thân. Bạn sẽ vừa phục vụ gia đình, cộng đồng vừa thực hiện những đam mê của riêng bản thân, lúc này công việc sẽ phức tạp và bận rộn hơn nhiều.`
        });
    } else if (isMany2 && has7) {
        // Có nhiều số 2 & CÓ 7
        cards.push({
            title: title2,
            content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy tập trung phục vụ mọi người, và thực hiện các nghĩa vụ, trách nhiệm với cộng đồng, cũng như với gia đình. Bạn có nhiều nghĩa vụ, trách nhiệm cần chủ động nhận ra. Chức vụ càng lớn thì trách nhiệm càng lớn. Càng phục vụ cho người khác thì sự thăng tiến của bạn sẽ càng nhanh.<br/>Những công việc mà bạn cần tập trung đều nằm trước mắt bạn. Bao gồm cả việc chia sẻ kiến thức chuyên môn.<br/><b>LƯU Ý:</b> Bạn làm để phục vụ cộng đồng vì tình yêu, chứ không phải vì mục đích lợi lạc cho bản thân. Bạn sẽ vừa phục vụ gia đình, cộng đồng vừa thực hiện những đam mê của riêng bản thân, lúc này công việc sẽ phức tạp và bận rộn hơn nhiều.`
        });
    }
}

// --- LOGIC XỬ LÝ SỐ 9 (VÀ CÁC TRƯỜNG HỢP KHÔNG CÓ 9) ---
const count9 = counts[9] || 0;

if (count9 === 1) {
    // 1 SỐ 9
    cards.push({
        title: rep(9, count9),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy tìm kiếm việc làm, tức một công việc nào đó mà có thể tạo ra tiền.<br/>Nếu còn trẻ, hãy làm nhiều việc khác nhau, tỷ lệ được nhận việc sẽ cao và đảm bảo tài chính. Bạn có thể bày ra cái gì đó để bán, bán tùy thích, miễn tốt cho khách hàng.<br/>Khi bán hàng, phải linh hoạt, cần đa dạng sản phẩm để khách hàng quay lại. Có như thế thì tài chính của bạn mới tốt hơn.`
    });
} else if (count9 >= 2) {
    // 2 SỐ 9 TRỞ LÊN
    cards.push({
        title: rep(9, count9),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Bạn cần bán những sản phẩm mà tính ứng dụng của sản phẩm phải cao, phải có giá trị cao, tức sản phẩm đó hầu như ai ai cũng đều cần, đều cảm thấy mức giá đó có thể bỏ tiền ra mua được. Bạn cần có chuyên môn giỏi về việc đó.<br/>Khách hàng mua khi sản phẩm phải rất giá trị, rất phù hợp mới mua. Thế nên bạn phải lựa chọn những sản phẩm, công việc để thể hiện con người của bạn ở mức độ cao cấp hơn, chứ không bán tùy thích.`
    });
} else {
    // KHÔNG CÓ SỐ 9
    if (has3) {
        // KHÔNG CÓ 9 & CÓ 3
        cards.push({
            title: `Không 9 & có ${rep(3, counts[3])}`,
            content: `Hãy chủ động ra ngoài ngoại giao để tìm kiếm khách hàng mới. Bạn có thể quảng cáo, PR, đặt lịch với KOL để họ quảng bá cho bạn.<br/>Để bán sản phẩm nào đó, bạn cần gặp gỡ và tương tác với nhiều người mới. Nếu bán sản phẩm mà bạn ngại tương tác với người lạ thì bạn sẽ khó bán được. Bạn rất cần người khác lan tỏa và giới thiệu sản phẩm cho nhiều người cùng biết.`
        });
    } else if (!has3 && !has8) {
        // KHÔNG CÓ 9, KHÔNG CÓ 3 VÀ KHÔNG CÓ 8
        cards.push({
            title: "Không 9, 3 & 8",
            content: `Bạn sẽ hơi khó kiếm tiền trong tháng này. Tốt nhất nên tập trung vào nghĩa vụ, trách nhiệm của bạn với người khác.<br/>Có những tháng bạn sẽ khó kiếm tiền hơn, thế nên hãy tận dụng mọi cơ hội ở những tháng khác. Hiểu điều này để bản thân trở nên nhẹ nhàng hơn, thoải mái hơn, không bị áp lực với việc kiếm tiền. Hoặc lộ trình trả nợ của mình sẽ được tính toán thật kỹ lưỡng và có độ hiệu quả cao hơn.`
        });
    }
}

// --- LOGIC XỬ LÝ SỐ 4 ---
const count4 = counts[4] || 0;
if (count4 > 0) {
    cards.push({
        title: rep(4, count4),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Nếu bạn cảm thấy có bệnh ở đâu đó thì hãy tập trung chữa cơn đau cho hết. Chăm sóc sức khỏe được ưu tiên hàng đầu vào tháng này.<br/>Hãy tạm gác hết công việc qua 1 bên, để ưu tiên tập trung chữa bệnh trước. Một khi sức khỏe có vấn đề thì bạn sẽ khó để tập trung làm việc gì khác một cách hiệu quả được (ví dụ: tay chân yếu, trúng gió, tiêu hóa kém, rụng tóc, mụn...).`
    });
}

// --- LOGIC XỬ LÝ SỐ 5 ---
const count5 = counts[5] || 0;
if (count5 > 0) {
    cards.push({
        title: rep(5, count5),
        content: `<b>VIỆC CẦN LÀM:</b><br/>Hãy ra ngoài tương tác, chia sẻ, thảo luận, đào tạo,… nhiều nhất có thể. Mục tiêu là để bạn luyện khả năng ăn nói, diễn đạt sao cho khéo léo, dễ thương và ai ai cũng hiểu được ý của bạn.<br/>Hãy luyện nói, luyện cách diễn đạt nhiều lên. Nếu không luyện thường xuyên thì cách nói chuyện của bạn vô tình có thể tạo ra sự khó hiểu, dễ gây cấn tâm cho đối phương, thậm chí là tạo ra sự cãi vã, mâu thuẫn.`
    });
// ... (đoạn trên giữ nguyên)
} else {
    // KHÔNG CÓ SỐ 5
    if (count6 === 0) {
        // KHÔNG CÓ 5 & KHÔNG CÓ 6
        cards.push({
            title: "Không 5",
            content: `Hãy im lặng nhiều hơn, bớt nói lại, chỉ nói khi thật sự cần thiết. Đừng xen vào chuyện của người khác, nếu không, bạn sẽ dễ gặp xui xẻo. Nhất là khi vừa không có số 5 mà lại có số 6, mà miệng lại nhanh hơn não thì rất dễ gây ra hiềm khích.`
        });
    } else {
        // KHÔNG CÓ 5 & CÓ 6
        cards.push({
            // CŨ: title: `Không 5 & ${rep(6, count6)}`,
            // MỚI (Thêm chữ 'có' cho rõ ràng):
            title: `Không 5 & có ${rep(6, count6)}`,
            content: `Hãy im lặng nhiều hơn, bớt nói lại, chỉ nói khi thật sự cần thiết. Đừng xen vào chuyện của người khác, nếu không, bạn sẽ dễ gặp xui xẻo.<br/><b>LƯU Ý:</b> Hãy suy nghĩ thật kỹ trước khi nói, vì bạn rất dễ phạm sai lầm, thiếu cẩn ngôn, dễ gây ra hiềm khích, cấn tâm cho người khác.`
        });
    }
}
      
      
            return { name, day, month: monthStr, year: yearStr, vibe: vibes[n1 % vibes.length], cards };
        }

        function exportPDF(name) {
            const el = document.getElementById('print-area');
            const originalStyle = { width: el.style.width, padding: el.style.padding, boxShadow: el.style.boxShadow, margin: el.style.margin };
            el.style.width = '210mm'; el.style.padding = '20mm'; el.style.boxShadow = 'none'; el.style.margin = '0 auto';
            const opt = { margin: 0, filename: `Bao_Cao_${name.replace(/\s+/g, '_')}.pdf`, image: { type: 'jpeg', quality: 1 }, html2canvas: { scale: 2, useCORS: true, letterRendering: true }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
            window.html2pdf().set(opt).from(el).save().then(() => { Object.assign(el.style, originalStyle); }).catch(() => { Object.assign(el.style, originalStyle); });
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MatrixWisdomApp />);
    </script>
</body>
</html>
